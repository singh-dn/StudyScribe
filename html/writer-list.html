<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Writers - StudyScribe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --primary: 262 83% 61%; }
        body { font-family: 'Inter', sans-serif; background-color: #F0F2F5; }
        .text-primary { color: hsl(var(--primary)); }
        .bg-primary { background-color: hsl(var(--primary)); }
        .ring-primary { --tw-ring-color: hsl(var(--primary)); }
        .border-primary { border-color: hsl(var(--primary)); }
        .btn-anim:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        .writer-card { transition: all 0.3s ease; }
        .writer-card:hover { transform: scale(1.03); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- =========== Top Navigation =========== -->
    <header class="sticky top-0 bg-white/80 backdrop-blur-sm border-b border-gray-200 z-30">
        <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 -mb-px">
                <div class="flex items-center space-x-4">
                    <a href="#" class="flex items-center gap-2"><span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-tr from-purple-600 to-cyan-500 text-white shadow-sm">SS</span><span class="font-extrabold tracking-tight text-xl hidden sm:inline">StudyScribe</span></a>
                </div>
                <div id="nav-right-side" class="hidden items-center space-x-3">
                    <button class="p-2 rounded-full hover:bg-gray-100 transition-colors relative"><i data-lucide="bell" class="w-5 h-5 text-gray-500"></i></button>
                    <div class="relative" id="profile-dropdown-container">
                        <button id="profile-dropdown-btn" class="flex items-center space-x-2">
                            <img id="navbar-profile-image" class="h-8 w-8 rounded-full object-cover" src="https://api.dicebear.com/9.x/initials/svg?seed=U" alt="User avatar">
                            <span id="navbar-user-name" class="hidden md:inline text-sm font-medium">User</span><i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                        </button>
                        <div id="profile-dropdown-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 border">
                            <a href="#" id="my-profile-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">My Profile</a>
                            <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Logout</a>
                        </div>
                    </div>
                </div>
                <div id="nav-login-link" class="hidden">
                    <a href="./login.html" class="text-sm font-semibold text-primary hover:underline">Log In</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
        <section class="text-center mb-12">
            <h1 class="text-4xl font-extrabold tracking-tight text-gray-900">Find Your Perfect Writer</h1>
            <p class="mt-2 text-lg text-gray-500 max-w-2xl mx-auto">Browse our community of verified experts ready to help you succeed.</p>
        </section>
        
        <section class="mb-12 sticky top-[65px] bg-gray-50/80 backdrop-blur-sm z-20 py-4">
            <div class="bg-white p-4 rounded-lg shadow-sm border">
                <div class="grid sm:grid-cols-2 gap-4">
                    <div class="relative"><i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i><input type="text" id="filter-skill" placeholder="Filter by skill..." class="w-full pl-9 pr-4 py-2 border rounded-full text-sm"></div>
                    <div class="relative"><i data-lucide="school" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i><input type="text" id="filter-college" placeholder="Filter by college..." class="w-full pl-9 pr-4 py-2 border rounded-full text-sm"></div>
                </div>
            </div>
        </section>

        <section>
            <div id="loading-state" class="text-center py-10"><p class="text-gray-600">Loading available writers...</p></div>
            <div id="writers-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
            <div id="no-results" class="hidden text-center py-10"><i data-lucide="search-x" class="w-12 h-12 mx-auto text-gray-400"></i><p class="mt-4 text-gray-600">No writers found. Try adjusting your filters.</p></div>
        </section>
    </main>
    
    <!-- MODAL -->
    <div id="writer-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                 <h2 id="modal-name" class="text-xl font-bold"></h2>
                 <button id="close-modal-btn" class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="overflow-y-auto custom-scrollbar p-6 space-y-6">
                <!-- Modal Body -->
                <div class="flex flex-col sm:flex-row items-center gap-6">
                    <img id="modal-profile-image" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg flex-shrink-0" src="">
                    <div class="text-center sm:text-left">
                        <p id="modal-qualification" class="text-primary font-semibold"></p>
                        <p id="modal-location" class="text-sm text-gray-500 mt-1"></p>
                    </div>
                </div>
                <div><h3 class="font-bold text-md mb-2">About Me</h3><p id="modal-bio" class="text-gray-600 leading-relaxed text-sm"></p></div>
                <div><h3 class="font-bold text-md mb-2">Handwriting Sample</h3><img id="modal-handwriting" src="" class="rounded-lg border shadow-sm w-full max-w-sm"></div>
                <div><h3 class="font-bold text-md mb-2">Skills</h3><div id="modal-skills" class="flex flex-wrap gap-2"></div></div>
                <div><h3 class="font-bold text-md mb-2">Services</h3><div id="modal-services" class="flex flex-wrap gap-2"></div></div>
                <div><h3 class="font-bold text-md mb-2">Verification Documents</h3><div class="flex flex-wrap gap-4 text-sm"><a id="modal-notes-link" href="#" target="_blank" class="flex items-center gap-2 text-purple-600 hover:underline"><i data-lucide="file-text" class="w-4 h-4"></i>View Notes Sample</a><a id="modal-cert-link" href="#" target="_blank" class="flex items-center gap-2 text-purple-600 hover:underline"><i data-lucide="file-badge-2" class="w-4 h-4"></i>View Certification</a></div></div>
            </div>
            <div class="p-4 bg-gray-50 border-t"><a id="modal-chat-btn" href="#" class="w-full text-center block bg-primary text-white font-semibold py-3 px-4 rounded-full text-sm hover:opacity-90 transition btn-anim">Chat Now</a></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, where, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWe8cVgxALsLWESxf7kdFiFbhYTj4JQtQ",
            authDomain: "campusreach-c57e0.firebaseapp.com",
            projectId: "campusreach-c57e0",
            storageBucket: "campusreach-c57e0.firebasestorage.app",
            messagingSenderId: "294813850577",
            appId: "1:294813850577:web:49cd5cbe8240d486105ef0"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let allWriters = [];

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            fetchAllWriters();
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const docSnap = await getDoc(doc(db, "users", user.uid));
                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        document.getElementById('navbar-profile-image').src = userData.profileImage || `https://api.dicebear.com/9.x/initials/svg?seed=${userData.fullname}`;
                        document.getElementById('navbar-user-name').textContent = userData.fullname;
                        document.getElementById('my-profile-link').href = userData.role === 'student' ? './student-dashboard.html' : './writer-dashboard.html';
                        document.getElementById('nav-right-side').classList.remove('hidden');
                        document.getElementById('nav-right-side').classList.add('flex');
                        document.getElementById('nav-login-link').classList.add('hidden');
                    }
                } else {
                    document.getElementById('nav-right-side').classList.add('hidden');
                    document.getElementById('nav-login-link').classList.remove('hidden');
                }
            });
            
            // --- Event Listeners ---
            const filterSkillInput = document.getElementById('filter-skill');
            const filterCollegeInput = document.getElementById('filter-college');
            filterSkillInput.addEventListener('input', applyFilters);
            filterCollegeInput.addEventListener('input', applyFilters);

            document.getElementById('writers-grid').addEventListener('click', (e) => {
                const writerCard = e.target.closest('[data-writer-id]');
                if (writerCard) {
                    const writerId = writerCard.dataset.writerId;
                    const writerData = allWriters.find(w => w.id === writerId);
                    if (writerData) openWriterModal(writerData);
                }
            });

            // Modal Controls
            const modal = document.getElementById('writer-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
            
            const profileBtn = document.getElementById('profile-dropdown-btn');
            const profileMenu = document.getElementById('profile-dropdown-menu');
            profileBtn.addEventListener('click', (e) => { e.stopPropagation(); profileMenu.classList.toggle('hidden'); });
            document.addEventListener('click', () => profileMenu.classList.add('hidden'));
            document.getElementById('logout-btn').addEventListener('click', (e) => { e.preventDefault(); signOut(auth); });

        });
        
        async function fetchAllWriters() {
            const loadingState = document.getElementById('loading-state');
            loadingState.classList.remove('hidden');
            const q = query(collection(db, "users"), where("role", "==", "writer"), where("profileSetupComplete", "==", true));
            const querySnapshot = await getDocs(q);
            allWriters = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            displayWritersGrid(allWriters);
            loadingState.classList.add('hidden');
        }

        function displayWritersGrid(writers) {
            const writersGrid = document.getElementById('writers-grid');
            const noResults = document.getElementById('no-results');
            writersGrid.innerHTML = '';

            if (writers.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');

            writers.forEach(writer => {
                const card = document.createElement('div');
                card.className = 'writer-card bg-white rounded-lg shadow-sm border overflow-hidden cursor-pointer';
                card.setAttribute('data-writer-id', writer.id);
                card.innerHTML = `
                    <div class="h-32 bg-cover bg-center" style="background-image: url('${writer.handwritingImageUrl}')"></div>
                    <div class="p-4">
                        <div class="flex items-center gap-3 -mt-12">
                            <img class="w-16 h-16 rounded-full object-cover border-4 border-white shadow-md" src="${writer.profileImage || `https://api.dicebear.com/9.x/initials/svg?seed=${writer.fullname}`}" alt="${writer.fullname}">
                            <div>
                               <h3 class="font-bold">${writer.fullname}</h3>
                               <p class="text-xs text-gray-500">${writer.studyBackground}</p>
                            </div>
                        </div>
                        <div class="mt-3 flex flex-wrap gap-1">
                             ${(writer.skills || []).slice(0, 2).map(skill => `<span class="bg-purple-100 text-purple-800 text-xs font-medium px-2 py-0.5 rounded-full">${skill}</span>`).join('')}
                        </div>
                    </div>
                `;
                writersGrid.appendChild(card);
            });
        }
        
        function openWriterModal(writerData) {
            document.getElementById('modal-name').textContent = writerData.fullname;
            document.getElementById('modal-profile-image').src = writerData.profileImage || `https://api.dicebear.com/9.x/initials/svg?seed=${writerData.fullname}`;
            document.getElementById('modal-qualification').textContent = writerData.studyBackground;
            document.getElementById('modal-location').textContent = `${writerData.writerLocation.city}, ${writerData.writerLocation.state}`;
            document.getElementById('modal-bio').textContent = writerData.bio;
            document.getElementById('modal-chat-btn').href = `./chat.html?userId=${writerData.uid}`;
            document.getElementById('modal-handwriting').src = writerData.handwritingImageUrl;

            const createTags = (containerId, items) => {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                (items || []).forEach(item => {
                    const tag = document.createElement('span');
                    tag.className = 'bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-1 rounded-full';
                    tag.textContent = item;
                    container.appendChild(tag);
                });
             };
            createTags('modal-skills', writerData.skills);
            createTags('modal-services', writerData.services);

            document.getElementById('modal-notes-link').href = writerData.notesSampleUrl;
            document.getElementById('modal-cert-link').href = writerData.certificationUrl;
            
            document.getElementById('writer-modal').classList.remove('hidden');
            lucide.createIcons();
        }

        function applyFilters() {
            const skillTerm = document.getElementById('filter-skill').value.toLowerCase().trim();
            const collegeTerm = document.getElementById('filter-college').value.toLowerCase().trim();
            
            const filtered = allWriters.filter(writer => {
                const skillMatch = !skillTerm || (writer.skills || []).some(skill => skill.toLowerCase().includes(skillTerm));
                const collegeMatch = !collegeTerm || (writer.collegeNameFull || '').toLowerCase().includes(collegeTerm);
                return skillMatch && collegeMatch;
            });
            displayWritersGrid(filtered);
        }
    </script>
</body>
</html>

